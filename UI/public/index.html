<!DOCTYPE html>
<html lang="en-us">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>piEQ</title>
		
		<script src="js/NexusUI.js"></script>
		<script src="js/jquery-3.5.1.min.js"></script>
	</head>

	<body>
		<div id="mainui">
			<table>
				<tr>
					<td>
						<p>Pre-gain (dB)</p>
					</td>
					<td>
						<div nexus-ui="slider" id="pgs"></div>
					</td>
					<td>
						<div nexus-ui="number" id="pgn"></div>
					</td>
					<td>
						<div nexus-ui="textbutton" id="reset"></div>
					</td>
				</tr>
			</table>
			<div style="height:80px;"></div>
			<table>
				<tr>
					<td>
					</td>
					<td>
						<div nexus-ui="slider" id="gs0"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs1"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs2"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs3"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs4"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs5"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs6"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs7"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs8"></div>
					</td>
					<td>
						<div nexus-ui="slider" id="gs9"></div>
					</td>
				</tr>
				<tr>
					<td>
						<p>Gain (dB)</p>
					</td>
					<td>
						<div nexus-ui="number" id="gn0"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn1"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn2"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn3"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn4"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn5"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn6"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn7"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn8"></div>
					</td>
					<td>
						<div nexus-ui="number" id="gn9"></div>
					</td>
				</tr>
			</table>
		</div>
		
		<script>
			var mainui = new Nexus.Rack("#mainui");
			
			//set attributes 
			
			mainui.pgs.resize (120, 40)
			
			mainui.gs0.resize (40, 240);
			mainui.gs1.resize (40, 240);
			mainui.gs2.resize (40, 240);
			mainui.gs3.resize (40, 240);
			mainui.gs4.resize (40, 240);
			mainui.gs5.resize (40, 240);
			mainui.gs6.resize (40, 240);
			mainui.gs7.resize (40, 240);
			mainui.gs8.resize (40, 240);
			mainui.gs9.resize (40, 240);
			
			mainui.pgs.min = -24;
			
			mainui.gs0.min = -12;
			mainui.gs1.min = -12;
			mainui.gs2.min = -12;
			mainui.gs3.min = -12;
			mainui.gs4.min = -12;
			mainui.gs5.min = -12;
			mainui.gs6.min = -12;
			mainui.gs7.min = -12;
			mainui.gs8.min = -12;
			mainui.gs9.min = -12;
			
			mainui.pgs.max = 12;
			
			mainui.gs0.max = 12;
			mainui.gs1.max = 12;
			mainui.gs2.max = 12;
			mainui.gs3.max = 12;
			mainui.gs4.max = 12;
			mainui.gs5.max = 12;
			mainui.gs6.max = 12;
			mainui.gs7.max = 12;
			mainui.gs8.max = 12;
			mainui.gs9.max = 12;
			
			mainui.pgs.step = 0.1;
			
			mainui.gs0.step = 0.1;
			mainui.gs1.step = 0.1;
			mainui.gs2.step = 0.1;
			mainui.gs3.step = 0.1;
			mainui.gs4.step = 0.1;
			mainui.gs5.step = 0.1;
			mainui.gs6.step = 0.1;
			mainui.gs7.step = 0.1;
			mainui.gs8.step = 0.1;
			mainui.gs9.step = 0.1;
			
			mainui.pgn.link(mainui.pgs);
			
			mainui.gn0.link(mainui.gs0);
			mainui.gn1.link(mainui.gs1);
			mainui.gn2.link(mainui.gs2);
			mainui.gn3.link(mainui.gs3);
			mainui.gn4.link(mainui.gs4);
			mainui.gn5.link(mainui.gs5);
			mainui.gn6.link(mainui.gs6);
			mainui.gn7.link(mainui.gs7);
			mainui.gn8.link(mainui.gs8);
			mainui.gn9.link(mainui.gs9);
			
			mainui.reset.text = "Reset";
			
			//function to pass control data back to node 
			function postControl (data) {
				console.log(data.filter);
				console.log(data.value);
				$.ajax({
					url: '/control', 
					type: "POST",
					contentType: 'application/json',
					data: JSON.stringify(data)
				});
			}
			
			// event handlers for GUI elements, posts json to node for OSC 
			
			mainui.pgs.on('change', function(v){
				var data = {filter: "pg", param: "gain", value: v};
				postControl(data);
			})
			
			
			//set change event behavior for gain sliders
			
			//attempt to do a loop doesn't work.
			/*var gsData = []; //Array to hold gain slider identifiers
			for (var i = 0; i < 9; i++){
				var gsi = "gs" + i;
				mainui[gsi].on('change', function(v){
					//var index = i;
					gsData[i] = {filter: "f" + i, param: "gain", value: v};
					postControl(gsData[i]);
				});
			}
			*/
			mainui.gs0.on('change', function(v){
				var data = {filter: "f0", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs1.on('change', function(v){
				var data = {filter: "f1", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs2.on('change', function(v){
				var data = {filter: "f2", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs3.on('change', function(v){
				var data = {filter: "f3", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs4.on('change', function(v){
				var data = {filter: "f4", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs5.on('change', function(v){
				var data = {filter: "f5", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs6.on('change', function(v){
				var data = {filter: "f6", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs7.on('change', function(v){
				var data = {filter: "f7", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs8.on('change', function(v){
				var data = {filter: "f8", param: "gain", value: v};
				postControl(data);
			})
			mainui.gs9.on('change', function(v){
				var data = {filter: "f9", param: "gain", value: v};
				postControl(data);
			})
			
			
			//Quick reset function
			
			mainui.reset.on('change', function (v){
				if (mainui.reset.state == true){
					reset();
				}
			})
			
			function reset(){
				for (var i = 0; i < 10; i++){
					var gsi = "gs" + i;
					mainui[gsi].value = 0;
				}
				mainui.pgs.value = 0;
			}
			
			//saving current state of all UI elements in JSON to store presets
			var currentState = {};
			
			function setCurrentState (){
				for (var i = 0; i < 10; i++){
					var gsi = "gs" + i;
					var value = mainui[gsi].value;
					currentState[gsi] = {"value" : value};
				}
			}
			
			function saveCurrentState(){
				$.ajax({
					url: '/preset', 
					type: "POST",
					contentType: 'application/json',
					data: JSON.stringify(currentState)
				});
			}
			
		</script>
	</body>

</html>